---
title: "IPMH: Integration of stepped care for perinatal mood and anxiety disorders among women attending MCH clinics"

subtitle: 'Data and Safety Monitoring Board (DSMB): Open Report '
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, options(scipen = 0))

library(stringr)
library(lubridate)
library(patchwork)
library(officedown)
library(officer)
library(flextable)

## WORKING DIRECTORY
# Setup ------------------------------------------------------------------------
rm(list = ls())             

# Reference source codes & other dependencies:
source("DataTeam_ipmh.R")
source("Dependencies.R")

# Set file paths: Use this section to set input and output filepaths
file_date <- fileSnapshot(file.path(ipmh_filepath, "/Data/6. RCT PPW data/"))
file_date <- rownames(file_date$info[which.max(file_date$info$mtime),])
file_date <- gsub("^.*?_2","2",file_date)
file_date <- str_remove(file_date,".csv")
file_date <- format(file_date, format="%d %B %Y")
ppw_rct_df <- read.csv(paste0(ipmh_filepath, "/Data/6. RCT PPW data/RCT_PPW_", 
                              file_date, ".csv", sep="")) %>% 
    filter(is.na(redcap_repeat_instance)) #PPW data

daily_closeout_df <- read.csv(paste0(ipmh_filepath, "/Data/7. RCT admin data/Daily_closeout_", 
                                     file_date, ".csv", sep=""))

screening_consent_df <- read.csv(paste0(ipmh_filepath, 
                                        "/Data/2. Consenting database/RCT_PPW_consenting_", 
                                        file_date, ".csv", sep=""))

pm_survey_df <- read.csv(paste0(ipmh_filepath, "/Data/7. RCT admin data/PM_", 
                                file_date, ".csv", sep="" ))

ppw_sae_df <- read.csv(paste0(ipmh_filepath, "/Data/6. RCT PPW data/RCT_PPW_", 
                                             file_date, ".csv", sep="")) %>% 
    filter(redcap_repeat_instrument == "ADMIN: Adverse Experience")

data_freeze <- file_date

data_freeze <- format(data_freeze, format="%d %B %Y")
options(scipen = 0)
```


```{r logo,  out.width = "100%", echo=FALSE, eval = T, fig.height=4, fig.width=4}

knitr::include_graphics(paste0(file.path(ipmh_filepath, "/Data/IPMH logo.jpg")))

```

\newpage

John Kinuthia, MBChD, MMed, MPH, Kenyatta National Hospital

Keshet Ronen, PhD, MPH, University of Washington

Amritha Bhat, MBBS, MD, MPH, University of Washington

Report prepared by: David Owaga & Yuwei Wang

Date of data freeze: `r data_freeze`

\newpage

\tableofcontents

\newpage

# 1. Study summary

```{r study_summary}
vars <- c("Primary Objective", "Study Design", "Study Population", "Inclusion Criteria",
          "Target Sample Size",
          "Actual Enrollment",
          "Participants Completed Follow-up", "Duration", 
          "Date Study Open", "Date of First Complete Enrollment",
          "Estimated End of Study",
          "Endpoints", "")

vars2 <- c("Integrate IPMH, a stepped care intervention for screening and treatment of perinatal mood and anxiety disorders (PMADs), and its implementation strategies, into maternal and child health clinics and pragmatically evaluate its clinical, service delivery, and implementation outcomes",
           "A 2-arm, non-blinded cluster randomized controlled trial (RCT) comparing the effect of IPMH and associated implementation strategies on depression, anxiety, quality of life, and adverse perinatal outcomes vs. control (standard of care) among Kenyan women", 
           "Pregnant Kenyan women", 
           "-Receiving antenatal care at study facility\n->=28 weeks gestation\n-Age>=14\n-screen positive for PMAD symptoms (PHQ-2>=3 and/or GAD-2>=3)", 
           "2970, including 405 women living with HIV (WLWH)", 
           "[place holder]",
           "0",
           "Follow-up through 6 months postpartum", 
           "[place holder]", 
           "February 17, 2025",
           "[place holder]",
           "Primary: Depression and anxiety", 
           "Secondary:\n-Depression and anxiety among WLWH\n-Quality of Life\n-Adverse perinatal outcomes")

stdy_summ <- data.frame(vars, vars2)

study_summary <- flextable(stdy_summ)
study_summary <- flextable::width(study_summary, 'vars2', width = 5)
study_summary <- flextable::width(study_summary, 'vars', width = 2)
border <- fp_border()
study_summary <- flextable::vline(study_summary, j = c('vars'), border = border, part = "all")
study_summary <- set_header_labels(study_summary, vars = "Title", vars2 = "IPMH: Integration of stepped care for perinatal mood and anxiety disorders among women attending MCH clinics")

study_summary
```

\newpage

## 1.1 Study Timeline Since Initiation:
-   May 12, 2023: Initial IRB approval
-   Jun 05, 2023: Initial ERC approval
-   Sep 19, 2023: RO1 Start date
-   Oct 04, 2024: Research assistant (RA) training initiation
-   Oct 11, 2024: 1st DSMB meeting
-   Oct 23, 2024: Facility randomization
-   Nov 06, 2024: Facility staff training initiation
-   Feb 17, 2025: Perinatal women recruitment initiation

## 1.2 Key Changes to Study Protocol
-N/A

# 2. Study Progress

## 2.1 Recruitment Timeline
```{r source_consort, echo=FALSE, warning=FALSE}
source("Consort.R")
n_anc <- consort_data %>% filter(anc_attendees=="Yes") %>% nrow()
n_ass<- consort_data %>% filter(!is.na(arm)) %>% nrow()
n_eligible <- consort_data %>% filter(!is.na(eligible)) %>% nrow()
n_eligible_per <- n_eligible/n_ass *100 %>% round(2)
n_enrol <- consort_data %>% filter(!is.na(rct_enrolling)) %>% nrow()
n_enrol_per <- n_enrol/n_eligible *100 %>% round(2)
n_second <- consort_data %>% filter(!is.na(secondvisit)) %>% nrow()
n_second_per <- n_second/n_enrol * 100 %>% round(2)
```
We began recruiting pregnant women into the study on Feb 17, 2025. 

In general, enrollment has proceeded well despite slow initial enrollment. {A series of national healthcare worker strikes (Mar 12, 2024 and May 8, 2024), flooding (Apr 23, 2024 and May 12, 2024), and ongoing national protests beginning Jun 18, 2024 have slowed data collection.} We should talk about the disruptions regarding USAID, strikes and protests here for IPMH.

\newpage

# 3. Study Enrollment 

## 3.1 Overall Cohort

### 3.1.1 Current subject status

So far, we screened `r n_ass` women for eligibility among `r n_anc` non-unique ANC attendees at recruitment sites. Of these, `r n_eligible` (`r n_eligible_per`%) were eligible across intervention and control clusters. `r n_enrol` (`n_enrol_per`%) participants consented to participate in the study and were enrolled into the study. `r n_second` (%) completed their 6 weeks postpartum visit.


```{r consort}
consort_per
```

\newpage


```{r enrolltargetsource,  message=FALSE, echo=FALSE}
source("enroll_linegraph_ppw.R")
```


### 3.1.2 Enrollment Progress - Overall

On May 29, 2024 we began restricting enrollments in facilities with >70 participants recruited to only 2 enrollments/week. We hit our enrollment target on `r sub_enroll100_date`.


```{r enrollment_sub,  message=FALSE}
source("enroll_linegraph_ppw.R")
p1
```


\newpage

### 3.1.3 Enrollment Progress - Per Facility

All facilities have hit the minimum target enrollment number of 80 peripartum women/facility cluster. The first cluster to reach the minimum recruitment number per facility was Masogo in mid May 2024. The last cluster to reach the minimum recruitment number per facility was KCH in early July 2024. 



```{r enrollment_sub_facility}
source("enroll_linegraph_ppw_zoom.R")
p2
```



\newpage

## 3.2 Mortality cohort

### 3.2.1 Current subject status
```{r consortnumsource, echo=FALSE}
source("weekly_consort.R")

```
From `r all_echispreg` pregnancies registered in eCHIS, `r eligpregs` pregnant women were registered before 37 weeks gestation. Of these `r deliveries` deliveries (`r deliveries_per`%) have been reported, of which `r livebirths` (`r round(livebirths/deliveries*100, 2)`%) were live births. Of these, `r infantstatus_28days_y` infants (`r round(infantstatus_28days_y/livebirths*100, 2)`%) have had home visits with the infant’s status reported at \>=28 days after birth. These data point to gaps or delays in routine reporting of births and completion of postnatal visits. The study team has been utilizing implementation strategies to encourage CHPs to complete follow-up visits in order to improve reporting.

```{r consort_mortality}
source("weekly_consort.R")
weekly_consort_mortcohort
```


\newpage

### 3.2.2 Enrollment Progress - Overall

Recruitment into the mortality cohort has been slower than expected but has been steadily improving. The study team has been utilizing implementation strategies to encourage CHPs to complete follow-up visits in order to improve delivery reporting.


```{r enrollment_mor}
source("morcohort_linegraphs.R")
p2
```


<!-- \newpage -->

<!-- ### 3.2.3 Infant Outcome Ascertainment Progress - Per Facility -->


<!-- ```{r enrollment_mor_facility} -->
<!-- source("morcohort_linegraphs.R") -->
<!-- p3 -->
<!-- ``` -->


\newpage

# 4. Subcohort Ineligibility
Total ineligible visits represents ANC visits at which a woman was assessed as ineligible to participate in the study. Clients are non-unique in this dataset because individual clients could be screened multiple times at different visits. A client may be determined as ineligible for multiple reasons.


```{r subcohort_prog}
source("weekly_consort.R")
vars <- c("Participated in CHV-NEO before/ In another study", 
          "Age", "Gestational age",
          "Phone access \n(No phone access, no safaricom/airtel, no phone number)",
          "Not willing to receive sms", 
          "Not able to stay in the area >3 months", "Not willing to provide contact info", "Not registered in eCHIS", "Not visited by study CHP/ village not in facility’s CUs",
          "Not able to read/respond to SMS",
          "Total ineligible visits")

vars2 <- c(enroll.no_othrstdy, enroll.no_age, enroll.no_gest, enroll.no_phoneacces, enroll.no_sms, enroll.no_locstay, enroll.no_contact, enroll.no_echis, enroll.no_chp, enroll.no_readwritesms, enroll.no)

percentages <- (vars2 / enroll.no) * 100
vars2_formatted <- ifelse(vars2 == enroll.no, enroll.no, paste0(vars2, " (", round(percentages, 2), "%)"))

ineligible_table <- data.frame(vars, vars2_formatted)

table_ineligibility <- flextable(ineligible_table)
table_ineligibility <- flextable::width(table_ineligibility, 'vars2_formatted', width = 2)
table_ineligibility <- flextable::width(table_ineligibility, 'vars', width = 5)
border <- fp_border()
table_ineligibility <- flextable::vline(table_ineligibility, j = c('vars'), border = border, part = "all")
table_ineligibility <- set_header_labels(table_ineligibility, vars = "Ineligible Reason \n(Participants can be ineligible for multiple reasons)", vars2_formatted = "N (%)")

table_ineligibility
```

\newpage

# 5. Baseline Demographics

## 5.1 Sub Cohort Participant Baseline Demographics



```{r demographics, warning=F}

source("comparison_table.R")

kable(weekly_demotable) %>%
kable_styling(latex_options = c("striped", "HOLD_position", position = "center")) %>%
  row_spec(0,bold=T) %>%
  row_spec(1,bold=T)
```

## 5.2 Mortality Cohort Baseline Demographics


```{r morcohort_demo, echo=FALSE}
source("mort_demo.R")

kable(mort_demo_open) %>%
kable_styling(latex_options = c("striped", "HOLD_position", position = "center")) %>%
  row_spec(0,bold=T) %>%
  row_spec(1,bold=T)

```


\newpage

# 6. Sub Cohort Study Terminations


```{r terminations"}
source("terminations_tbl.R")

kable_styling(terminations_summary) %>%
  kable_styling(latex_options = "HOLD_position") %>% 
  row_spec(0,bold=T,hline_after = T) %>% 
  row_spec(7,bold=T) 


```



```{r referralnumsource, echo=FALSE}
source("referrals.R")

```

# 7. Sub Cohort Referrals
At, both, enrollment and 6-week follow up study visits participants are asked if they would like to be referred for any conditions that they may have screened positive for during the study visit. Out of `r total_visits` total study visits, participants have screened positive for `r total_scr_num` (`r total_scr_per`) referable conditions. Of which, `r total_ref_num` (`r total_ref_per`) have accepted referrals for those conditions.


```{r referrals}
source("referrals.R")

kable_styling(referrals_summary) %>%
  kable_styling(latex_options = "HOLD_position") %>% 
  row_spec(0,bold=T,hline_after = T) %>% 
  row_spec(5,bold=T,hline_after = T) 
```

\newpage

# 8. Time from Delivery to eCHIS Delivery Report

Timely ascertainment of delivery enables timely scheduling of postpartum visits by CHPs and, in the intervention arm, initiation of time-sensitive postpartum messaging. The table below summarizes the time from delivery date to delivery report submission in eCHIS. 


```{r deliveryrepTAT}
source("deliveryreportTAT.R")
kable_styling(deliverytat_summary) %>%
  kable_styling(latex_options = "HOLD_position") %>% 
  row_spec(0,bold=T)
```

